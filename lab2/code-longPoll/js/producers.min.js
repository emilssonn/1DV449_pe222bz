$(document).ready(function(){$("#logout").bind("click",function(){window.location="logout.php"});$("#add_btn").bind("click",function(){var b=$('#name_txt').val();var c=$('#message_ta').val();var d=$('#mess_inputs').val();var e=$("#postToken").val();$.ajax({type:"POST",url:"functions.php",data:{function:"add",name:b,message:c,pid:d,postToken:e},timeout:22000}).done(function(a){alert(a);});});});var request=null;function changeProducer(c){if(request!==null)request.abort();var d=$("#mess_container");d.find("#mess_inputs").val(c);d.find("#mess_p_mess").empty();$.ajax({type:"GET",url:"functions.php",data:{function:"producers",pid:c}}).done(function(b){var j=JSON.parse(b);d.find("#mess_p_headline").text("Meddelande till "+j.name+", "+j.city);if(j.url!==""){d.find("#mess_p_kontakt").text("LÃ¤nk till deras hemsida "+j.url)}else{d.find("#mess_p_kontakt").text("Producenten har ingen webbsida")}if(j.imageURL!==""){d.find("#p_img_link").attr("href",j.imageURL);d.find("#p_img").attr("src",j.imageURL)}else{d.find("#p_img_link").attr("href","#");d.find("#p_img").attr("src","img/noimg.jpg")}if(j.messages!==null){j.messages.forEach(function(a){var p=$("<p class='message_container'></p>");p.append(document.createTextNode(a.message)).append("<br />Skrivet av: ").append(document.createTextNode(a.name)).append("<br />"+getMessageTimeText(a.time));d.find("#mess_p_mess").append(p)})}});d.show("slow");getNewMessages(c)}function getNewMessages(d){request=$.ajax({type:"GET",url:"functions.php",data:{function:"newMessages",pid:d,time:Math.round(Date.now()/1000)}}).done(function(b){if(b!="false"){var c=$("#mess_container");var j=JSON.parse(b);j.forEach(function(a){var p=$("<p class='message_container'></p>");p.append(document.createTextNode(a.message)).append("<br />Skrivet av: ").append(document.createTextNode(a.name)).append("<br />"+getMessageTimeText(a.time));c.find("#mess_p_mess").prepend(p)})}request=null;getNewMessages(d)})}function getMessageTimeText(a){var b=new Date(a*1000);var c=b.getMinutes();var d=b.getDate();var e=b.getMonth()+1;if(c<10){c="0"+c}if(d<10){d="0"+d}if(e<10){e="0"+e}return b.getFullYear()+"-"+e+"-"+d+" "+b.getHours()+":"+c+":"+b.getSeconds()}